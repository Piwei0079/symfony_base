{% extends 'base.html.twig' %}

{% block title %}Candidature - Étape {{ step }}/4{% endblock %}

{% block body %}
<div class="container mx-auto mt-10 px-4">
    <div class="flex justify-center">
        <div class="w-full max-w-2xl">
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <div class="bg-gray-100 px-6 py-4 border-b border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-800">Candidature</h3>
                </div>
                <div class="p-6">
                    {# Progress Bar #}
                    <div class="w-full bg-gray-200 rounded-full h-4 mb-6">
                        <div class="bg-blue-600 h-4 rounded-full text-xs font-medium text-blue-100 text-center p-0.5 leading-none transition-all duration-500" style="width: {{ (step / 4) * 100 }}%;">
                            Étape {{ step }} sur 4
                        </div>
                    </div>

                    {{ form_start(form, {'attr': {'class': 'space-y-4'}}) }}
                        {# Custom Form Rendering for Tailwind #}
                        {% for field in form %}
                            {% if 'hidden' not in field.vars.block_prefixes %}
                                <div>
                                    {{ form_label(field, null, {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                                    {{ form_widget(field, {'attr': {'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm'}}) }}
                                    {{ form_errors(field, {'attr': {'class': 'text-red-500 text-sm mt-1'}}) }}
                                    {{ form_help(field, {'attr': {'class': 'text-gray-500 text-xs mt-1'}}) }}
                                </div>
                            {% else %}
                                {{ form_widget(field) }}
                            {% endif %}
                        {% endfor %}

                        <div class="flex justify-between items-center mt-8">
                            {# Previous Button Logic #}
                            {% if step > 1 %}
                                {% set prev_step = step - 1 %}
                                {# Skip step 3 if coming back from 4 and no experience #}
                                {% if step == 4 and candidate.hasExperience == false %}
                                    {% set prev_step = 2 %}
                                {% endif %}
                                
                                <a href="{{ path('app_candidate_apply', {'step': prev_step}) }}" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors">
                                    &larr; Précédent
                                </a>
                            {% else %}
                                <div></div> {# Spacer #}
                            {% endif %}

                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors shadow-sm">
                                {% if step == 4 %}
                                    Envoyer ma candidature
                                {% else %}
                                    Suivant &rarr;
                                {% endif %}
                            </button>
                        </div>
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
