{% extends 'base.html.twig' %}

{% block title %}Candidature{% endblock %}

{% block body %}
<div class="container mx-auto px-4 py-8 max-w-2xl">
    <h1 class="text-3xl font-bold mb-8 text-center">Postuler</h1>

    {# Progress Bar #}
    <div class="mb-8">
        <div class="flex justify-between mb-2">
            {% for step in ['personal', 'experience', 'availability', 'consent', 'summary'] %}
                <div class="text-sm font-medium {{ flow.vars.data.currentStep == step ? 'text-blue-600' : 'text-gray-500' }}">
                    {{ loop.index }}
                </div>
            {% endfor %}
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2.5">
            {% set currentStepIndex = 0 %}
            {% if flow.vars.data.currentStep == 'personal' %}{% set currentStepIndex = 1 %}{% endif %}
            {% if flow.vars.data.currentStep == 'experience' %}{% set currentStepIndex = 2 %}{% endif %}
            {% if flow.vars.data.currentStep == 'availability' %}{% set currentStepIndex = 3 %}{% endif %}
            {% if flow.vars.data.currentStep == 'consent' %}{% set currentStepIndex = 4 %}{% endif %}
            {% if flow.vars.data.currentStep == 'summary' %}{% set currentStepIndex = 5 %}{% endif %}
            
            <div class="bg-blue-600 h-2.5 rounded-full" style="width: {{ (currentStepIndex / 5) * 100 }}%"></div>
        </div>
        <div class="text-center mt-2 text-sm text-gray-600">
            Étape {{ currentStepIndex }}/5
        </div>
    </div>

    <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
        {{ form_start(form) }}
            
            {% if flow.vars.data.currentStep == 'summary' %}
                <h2 class="text-xl font-bold mb-4">Résumé de votre candidature</h2>
                
                <div class="mb-4">
                    <h3 class="font-bold">Informations personnelles</h3>
                    <p>Nom : {{ flow.vars.data.firstName }} {{ flow.vars.data.lastName }}</p>
                    <p>Email : {{ flow.vars.data.email }}</p>
                    <p>Téléphone : {{ flow.vars.data.phone|default('Non renseigné') }}</p>
                </div>

                <div class="mb-4">
                    <h3 class="font-bold">Expérience</h3>
                    <p>Expérience : {{ flow.vars.data.hasExperience ? 'Oui' : 'Non' }}</p>
                    {% if flow.vars.data.hasExperience %}
                        <p>Détails : {{ flow.vars.data.experienceDetails }}</p>
                    {% endif %}
                </div>

                <div class="mb-4">
                    <h3 class="font-bold">Disponibilité</h3>
                    {% if flow.vars.data.isAvailableImmediately %}
                        <p>Disponible immédiatement</p>
                    {% else %}
                        <p>Date : {{ flow.vars.data.availabilityDate|date('d/m/Y') }}</p>
                    {% endif %}
                </div>
            {% endif %}

            {{ form_widget(form) }}

            <div class="flex justify-between mt-6">
                {% if form.navigator.previous is defined %}
                    <button type="submit" name="{{ form.navigator.previous.vars.full_name }}" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Précédent
                    </button>
                {% else %}
                    <div></div>
                {% endif %}

                {% if form.navigator.next is defined %}
                    <button type="submit" name="{{ form.navigator.next.vars.full_name }}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Suivant
                    </button>
                {% endif %}

                {# Check for finish button #}
                {% if form.navigator.finish is defined %}
                     <button type="submit" name="{{ form.navigator.finish.vars.full_name }}" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Valider
                    </button>
                {% endif %}
            </div>
            
            {# Hide default navigator rendering #}
            {% do form.navigator.setRendered %}
        {{ form_end(form) }}
    </div>
</div>
{% endblock %}
